#!/usr/bin/env perl6
use Database::PostgreSQL::LibPQ;
use SQLToPurs::Codegen;
use SQLToPurs::Parse;

multi MAIN(IO(Cool) $in = '/dev/stdin', IO(Cool) :$out = '/dev/stdout', Str(Cool) :$conn-str = '') {
  my $conn = Database::PostgreSQL::LibPQ::Connection.new($conn-str);
  my $codegen = SQLToPurs::Codegen.new($conn, $out.open(:w));
  my @stmts = parse($in.slurp);
  $codegen.stmt($_) for @stmts;
}
